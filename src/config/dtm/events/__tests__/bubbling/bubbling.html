<html>
  <head>
    <script src="/base/dist/config.js"></script>
    <script src="../configureEngineForEventTests.js"></script>
    <script>
      jasmine.clock().install();

      var aSpy = jasmine.createSpy();
      configureRuleForEventTests([
        {
          type: 'dtm.click',
          settings: {
            selector: '#a',
            bubbleFireIfParent: true,
            bubbleFireIfChildFired: true,
            bubbleStop: false
          }
        }
      ], aSpy);

      var bSpy = jasmine.createSpy();
      configureRuleForEventTests([
        {
          type: 'dtm.click',
          settings: {
            selector: '#b',
            bubbleFireIfParent: window.testSettings.bubbleFireIfParent,
            bubbleFireIfChildFired: window.testSettings.bubbleFireIfChildFired,
            bubbleStop: window.testSettings.bubbleStop,
            handlerOnElement: window.testSettings.eventHandlerOnElement
          }
        }
      ], bSpy);

      var cSpy = jasmine.createSpy();
      configureRuleForEventTests([
        {
          type: 'dtm.click',
          settings: {
            selector: '#c',
            bubbleFireIfParent: true,
            bubbleFireIfChildFired: true,
            bubbleStop: false
          }
        }
      ], cSpy);
    </script>
    <script src="/base/dist/engine.js"></script>
    <script src="/base/src/__tests__/testpage.js"></script>
    <script src="/base/node_modules/simulate/simulate.js"></script>
    <script>
      TestPage
        .waitForContentLoaded()
        .execute(function() {
          Simulate.click(document.getElementById('c'));

          // Actions are always run asynchronously.
          jasmine.clock().tick(1);

          expect(aSpy.calls.count()).toEqual(window.testSettings.aExecuted ? 1 : 0);
          expect(bSpy.calls.count()).toEqual(window.testSettings.bExecuted ? 1 : 0);
          expect(cSpy.calls.count()).toEqual(window.testSettings.cExecuted ? 1 : 0);
        })
        .start();
    </script>
  </head>
  <body>
    <div id="a">
      A
      <div id="b">
        B
        <div id="c">
          C
        </div>
      </div>
    </div>

    <script>
      _satellite.pageBottom();
    </script>
  </body>
</html>
