<html>
  <head>
    <script src="/base/dist/config.js"></script>
    <script src="../../__tests__/helpers/configureEngineForEventTests.js"></script>
    <script src="/base/src/__tests__/helpers/testpage.js"></script>
    <script>
      var ruleEvents = [
        {
          type: 'dtm.entersViewport',
          settings: {
            selector: '#test'
          }
        }
      ];

      var conditionSpy = jasmine.createSpy().and.returnValue(true);

      configureRuleForEventTests(ruleEvents, conditionSpy);

      jasmine.clock().install();

      TestPage
        .waitForContentLoaded()
        .execute(function() {
          // Give time for the poller to cycle.
          jasmine.clock().tick(10000);
          expect(conditionSpy.calls.count()).toEqual(0);

          var testElement = document.createElement('div');
          testElement.id = 'test';
          testElement.innerHTML = 'Test';
          document.body.appendChild(testElement);

          // Give time for the poller to cycle. The rule shouldn't be triggered because
          // the element isn't in view.
          jasmine.clock().tick(10000);
          expect(conditionSpy.calls.count()).toEqual(0);

          window.scrollTo(0, 3000);

          // Give time for the poller to cycle.
          jasmine.clock().tick(10000);
          expect(conditionSpy.calls.count()).toEqual(1);
        })
        .start();
    </script>
    <script src="/base/dist/engine.js"></script>

    <style type="text/css">
      #test {
        position: absolute;
        top: 3000px;
      }
    </style>
  </head>
  <body>
    <script>
      _satellite.pageBottom();
    </script>
  </body>
</html>
