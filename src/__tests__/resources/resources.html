<html>
  <head>
    <script>
      console.log('here');
      var testResourceExports = {};
      var receivedResourceExports;
      var neverRequiredResourceSpy = jasmine.createSpy();

      _satellite = {};

      _satellite.container = {
        extensions: {
          EXa: {
            displayName: 'Example Extension A',
            name: 'exampleExtensionA',
            delegates: {
              'exampleExtensionA/events/testEvent': {
                displayName: 'Test Event',
                script: function(module) {
                  var allTriggers = [];

                  window.triggerTestEvent = function() {
                    allTriggers.forEach(function(trigger) {
                      trigger();
                    });
                  };

                  module.exports = function(config, trigger) {
                    allTriggers.push(trigger);
                  };
                }
              },
              'exampleExtensionA/actions/testAction': {
                displayName: 'Test Action',
                script: function(module, require) {
                  var getResource = require('getResource');
                  receivedResourceExports = getResource('exampleExtensionA', 'testResource');
                  module.exports = function() {};
                }
              }
            },
            resources: {
              'exampleExtensionA/resources/testResource': {
                script: function(module) {
                  module.exports = testResourceExports;
                }
              }
            }
          },
          EXb: {
            displayName: 'Example Extension B',
            name: 'exampleExtensionB',
            resources: {
              'exampleExtensionB/resources/neverRequired': {
                script: neverRequiredResourceSpy.and.callFake(function(module) {
                  module.exports = {};
                })
              }
            }
          }
        },
        rules: [
          {
            events: [
              {
                delegateId: 'exampleExtensionA/events/testEvent'
              }
            ],
            actions: [
              {
                delegateId: 'exampleExtensionA/actions/testAction'
              }
            ]
          }
        ]
      };
    </script>
    <script src="/base/testrunner/engine.js"></script>
  </head>
  <body>
    <script>
      _satellite.pageBottom();

      TestPage.execute(function() {
        window.triggerTestEvent();
        expect(receivedResourceExports).toBe(testResourceExports);

        // The module should be called for even when it isn't required by anything. This is so
        // extensions can have logic that runs even when there are no event, condition, action,
        // or data element types configured.
        expect(neverRequiredResourceSpy.calls.count()).toBe(1);
      }).start();
    </script>
  </body>
</html>
