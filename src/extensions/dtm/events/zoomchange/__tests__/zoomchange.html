<html>
  <head>
    <script src="/base/dist/container.js"></script>
    <script src="../../__tests__/helpers/configureEngineForEventTests.js"></script>
    <script src="helpers/zoomChangeHelper.js"></script>
    <script>
      jasmine.clock().install();
      jasmine.clock().mockDate();

      var conditionSpy = jasmine.createSpy().and.returnValue(true);
      configureRuleForEventTests([
        {
          type: 'dtm.zoomchange',
          config: {}
        }
      ], conditionSpy);

      window.ongestureend = window.ontouchend = function() {};
      window.innerWidth = document.documentElement.clientWidth;
    </script>
    <script src="/base/dist/engine.js"></script>
    <script src="/base/src/__tests__/helpers/testpage.js"></script>
    <script src="/base/node_modules/simulate/simulate.js"></script>
    <script>
      TestPage
        .waitForContentLoaded()
        .execute(function() {
          // Make it look like we support touch events otherwise the zoomchange event logic
          // won't even run.
          window.ongestureend = window.ontouchend = function() {};

          Simulate.event(document, 'gestureend');
          window.innerWidth = document.documentElement.clientWidth / 1.5;

          expect(conditionSpy.calls.count()).toEqual(0);

          jasmine.clock().tick(1049);

          expect(conditionSpy.calls.count()).toEqual(0);

          jasmine.clock().tick(1);

          expect(conditionSpy.calls.count()).toEqual(1);
          assertZoomchangeCall({
            call: conditionSpy.calls.mostRecent(),
            method: 'pinch',
            zoom: '1.50'
          });

          Simulate.event(document, 'touchend');
          window.innerWidth = document.documentElement.clientWidth / 2;

          jasmine.clock().tick(1249);

          expect(conditionSpy.calls.count()).toEqual(1);

          jasmine.clock().tick(1);

          expect(conditionSpy.calls.count()).toEqual(2);
          assertZoomchangeCall({
            call: conditionSpy.calls.mostRecent(),
            method: 'double tap',
            zoom: '2.00'
          });
        })
        .start();
    </script>
  </head>
  <body>
    <script>
      _satellite.pageBottom();
    </script>
  </body>
</html>
